@model LuxuryResort.Areas.Admin.Models.DashboardViewModel

@{
    ViewData["Title"] = "Dashboard";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<div class="dashboard-header">
    <h1>Dashboard</h1>
    <p class="subtitle">Tổng quan hoạt động kinh doanh ngày hôm nay, @DateTime.Now.ToString("dd/MM/yyyy").</p>
</div>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon-wrapper" style="background-color: #eaf5ff;"><i class="fas fa-dollar-sign" style="color: #3498db;"></i></div>
        <div class="stat-info">
            <span class="stat-title">Doanh thu hôm nay</span>
            <span class="stat-value">@Model.TodaysRevenue.ToString("N0")₫</span>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon-wrapper" style="background-color: #e8f7f0;"><i class="fas fa-calendar-plus" style="color: #2ecc71;"></i></div>
        <div class="stat-info">
            <span class="stat-title">Đặt phòng mới</span>
            <span class="stat-value">@Model.NewBookingsCount</span>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon-wrapper" style="background-color: #fff8e7;"><i class="fas fa-plane-departure" style="color: #f39c12;"></i></div>
        <div class="stat-info">
            <span class="stat-title">Khách check-in</span>
            <span class="stat-value">@Model.CheckInsCount</span>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon-wrapper" style="background-color: #fdeeee;"><i class="fas fa-plane-arrival" style="color: #e74c3c;"></i></div>
        <div class="stat-info">
            <span class="stat-title">Khách check-out</span>
            <span class="stat-value">@Model.CheckOutsCount</span>
        </div>
    </div>
</div>

<div class="dashboard-main-grid">
    <div class="main-column">
        <div class="dashboard-panel">
            <div class="panel-header">
                <h3>Đặt phòng gần đây</h3>
                <a href="#">Xem tất cả</a>
            </div>
            <div class="panel-body">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Khách hàng</th>
                            <th>Hạng phòng</th>
                            <th>Ngày nhận phòng</th>
                            <th>Trạng thái</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var booking in Model.RecentBookings)
                        {
                            <tr>
                                <td>@booking.GuestName</td>
                                <td>@booking.RoomType</td>
                                <td>@booking.CheckInDate.ToString("dd/MM/yyyy")</td>
                                <td><span class="status-badge status-@booking.Status.ToLower()">@booking.Status</span></td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>

        <div class="dashboard-panel">
            <div class="panel-header">
                <h3>Doanh thu 7 ngày gần nhất</h3>
            </div>
            <div class="panel-body">
                <canvas id="revenueBar" style="height:220px; max-height:220px; width:100%"></canvas>
            </div>
        </div>
    </div>

    <div class="sidebar-column">
        <div class="dashboard-panel">
            <div class="panel-header">
                <h3>Tình trạng phòng</h3>
            </div>
            <div class="panel-body">
                <ul class="room-status-list">
                    @foreach (var status in Model.RoomStatusCounts)
                    {
                        <li>
                            <span class="status-dot @status.Key.Replace(" & ", "").ToLower()"></span>
                            <span>@status.Key</span>
                            <span class="status-count">@status.Value</span>
                        </li>
                    }
                </ul>
            </div>
        </div>

        <div class="dashboard-panel">
            <div class="panel-header">
                <h3>Đặt phòng theo trạng thái</h3>
            </div>
            <div class="panel-body">
                <canvas id="statusPie" style="height:220px; max-height:220px; width:100%"></canvas>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const statusLabels = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.BookingsByStatus.Keys));
        const statusData = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.BookingsByStatus.Values));
        const ctxPie = document.getElementById('statusPie').getContext('2d');
        new Chart(ctxPie, {
            type: 'pie',
            data: {
                labels: statusLabels,
                datasets: [{
                    data: statusData,
                    backgroundColor: ['#2ecc71', '#f1c40f', '#e74c3c', '#3498db', '#9b59b6']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { position: 'bottom' } }
            }
        });

        const barLabels = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.Last7DaysLabels));
        const barData = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.Last7DaysRevenue));
        const ctxBar = document.getElementById('revenueBar').getContext('2d');
        new Chart(ctxBar, {
            type: 'bar',
            data: {
                labels: barLabels,
                datasets: [{
                    label: 'Doanh thu (₫)',
                    data: barData,
                    backgroundColor: '#3498db'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
    </script>
}