@model LuxuryResort.Models.Room

@{
    ViewData["Title"] = "Superior Garden View";
}

@section Styles {
    <link rel="stylesheet" href="~/css/superior-journey.css" asp-append-version="true" />
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
}

<nav class="journey-nav">
    <a href="#intro" class="nav-dot active" data-target="intro"></a>
    <a href="#details" class="nav-dot" data-target="details"></a>
    <a href="#gallery" class="nav-dot" data-target="gallery"></a>
    <a href="#booking" class="nav-dot" data-target="booking"></a>
</nav>

<main class="journey-container">
    <section id="intro" class="journey-section" style="background-image: url('@Model.ImageUrl')">
        <div class="section-content left">
            <span class="pre-title">Chào mừng đến</span>
            <h1 class="main-title">@Model.Type</h1>
            <p>Nơi trú ẩn yên bình, được bao bọc bởi khu vườn nhiệt đới xanh mướt. Một không gian được tạo ra để tái tạo năng lượng và tìm về sự tĩnh tại.</p>
        </div>
    </section>

    <section id="details" class="journey-section" style="background-image: url('https://images.pexels.com/photos/1287460/pexels-photo-1287460.jpeg');">
        <div class="section-content right">
            <h2 class="section-title">Chi Tiết Tinh Tế</h2>
            <div class="details-grid">
                <div class="detail-item">
                    <strong>Diện tích</strong>
                    <span>@Model.Area m²</span>
                </div>
                <div class="detail-item">
                    <strong>Sức chứa</strong>
                    <span>@Model.MaxOccupancy người lớn & @Model.MaxChildren trẻ em</span>
                </div>
                <div class="detail-item">
                    <strong>Giường</strong>
                    <span>1 Giường Queen</span>
                </div>
                <div class="detail-item">
                    <strong>Ban công</strong>
                    <span>Hướng vườn riêng</span>
                </div>
            </div>
        </div>
    </section>

    <section id="gallery" class="journey-section" style="background-image: url('https://images.pexels.com/photos/5998136/pexels-photo-5998136.jpeg');">
        <div class="section-content center">
            <h2 class="section-title">Những Góc An Nhiên</h2>
            <p>Mỗi góc nhỏ đều được chăm chút để mang lại cảm giác ấm cúng và thư thái.</p>
        </div>
    </section>

    <section id="booking" class="journey-section booking-final">
        <div class="section-content center booking-form">
            <h2 class="section-title">Bắt Đầu Kỳ Nghỉ Của Bạn</h2>
            <span class="price-from">Giá từ <strong>@Model.PricePerNight.ToString("N0") VNĐ</strong> / đêm</span>
            <div class="room-availability-info">
                @if (ViewBag.AvailableRooms > 0)
                {
                    <span class="availability-badge available">
                        <i class="fas fa-check-circle"></i>
                        Còn @ViewBag.AvailableRooms phòng trống
                    </span>
                }
                else
                {
                    <span class="availability-badge unavailable">
                        <i class="fas fa-times-circle"></i>
                        Đã kín phòng
                    </span>
                }
            </div>
            <form action="/Booking" method="get" class="simple-booking-form">
                <input type="hidden" name="roomId" value="@Model.Id" />
                <div class="form-group">
                    <label>Ngày nhận phòng</label>
                    <input type="date" name="checkin" required>
                </div>
                <div class="form-group">
                    <label>Ngày trả phòng</label>
                    <input type="date" name="checkout" required>
                </div>
                <button type="submit" class="btn-journey-book">Tiếp Tục Đặt Phòng</button>
            </form>
        </div>
    </section>

</main>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const sections = document.querySelectorAll('.journey-section');
            const navDots = document.querySelectorAll('.nav-dot');

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        navDots.forEach(dot => {
                            dot.classList.remove('active');
                            if (dot.getAttribute('data-target') === entry.target.id) {
                                dot.classList.add('active');
                            }
                        });
                    }
                });
            }, { threshold: 0.5 }); // Kích hoạt khi 50% section lọt vào màn hình

            sections.forEach(section => {
                observer.observe(section);
            });

            // Ràng buộc ngày tháng cho form cuối
            const checkinInput = document.querySelector('input[name="checkin"]');
            const checkoutInput = document.querySelector('input[name="checkout"]');
            if(checkinInput && checkoutInput) {
                 const today = new Date().toISOString().split('T')[0];
                 checkinInput.setAttribute('min', today);
                 checkinInput.addEventListener('change', function() {
                    const nextDay = new Date(this.value);
                    nextDay.setDate(nextDay.getDate() + 1);
                    checkoutInput.setAttribute('min', nextDay.toISOString().split('T')[0]);
                 });
            }
        });
    </script>
}